<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="./mobile-text-selection.js"></script>
  </head>
  <style>
    * {
      box-sizing: border-box;
    }
    html,
    body,
    #container {
      position: relative;
    }
    body {
      padding-top: 30px;
    }
    #popover {
      position: fixed;
      display: flex;
      user-select: none;
      visibility: hidden;

      border-radius: 4px;
      background-color: #000000;

      width: 120px;
      height: 40px;
    }

    #copyButton,
    #searchButton {
      flex: 1;
      border: 0;
      background-color: transparent;
      outline: none;
      color: #ffffff;
    }
    #searchButton {
      background-color: wheat;
    }

    #copyButton:active,
    #searchButton:active {
      color: #cccccc;
    }
  </style>
  <body>
    <div id="container">
      废芳蜻堡淡锋衫拘樱吹乐勤脑坏剧益篮仅夏挤辟获著煌厚汪幻笔跪厨由煮唐陷祖权刺没室观层王贝跟园键巨努评堆牺除器柄扩匆裁宇够既骨本级立耍还多滋吉啄福活逗吧堤朱损汇转茫扑恋试直慕的挺纹与谱侨例马问湖天圆仓州蔽恭飞馒电良准求杨钻持尺误以律圈狂被智凉绕耽愁剖微握滨雅鉴亡熊块兰薯风职莲泥宵歌紫何饼嫩些武样培融吨两兵孔面访丛港接诸推寄昆乘绒替都裂然猴形虏感芒隶避窜丢舌雀阀咽且齿乡仙痒监亭旱陆颗每判五骑颤供岛旅棕仔鲜辈鸡信敬驰欺锦督蔬概启罩款腐学商志弱稳灰较僵纳桶叹之扫括瓣秒中诉音棒稀击虚洪差守种们奶疲存磨鼻追课河许燥炊雨材女拨便蔑饥临索帝拍笨锹到盆育苏队海袜过架令界泡故址猎肝萌滴打颂晚搭揉控街俊切娃研蹈积脱尿闲纪脚斑方验送慨彩悔芝纠尘铺恩回下惰丝境群消印溉局沟贺斥公矩我宫伪独九螺古刷津旷图徐冲编迷违书砌凝巷费暴字抹蒜场带思刘煎移扯裤洗艺茧抗峡暮具躬测腾糖黑喷根把勺从歼哗铁年摊向厌坡汉迟关轨晒凭团作吞拒陕捡逝壁萍操棚儿鲁励享锯蒙僚身拾哲加称规役色亿实属识洲垃肚配陡闸招伍刮筹闯插伶桑领辨落秃尸谎特铲叉扭孤琴开约粒羡百忠慧固爆腹担慢管腰蜘雁苍码跳垂口率扒赖籍水掘甚杂待羊狡半远痰新裙郎香聚野郊鄙辱模一危纵型叨烫弃二惹顾乎颜看扰娘舱怒昏拉牧世蛮盯越初宴充热欠铃像阶轰俩舒生蹄光敲摸好滥久禾端窃邮巧嘱帅代喜淘眨涂熔银妇姓私乒药昨恶她明惊闪姥倾羽了警绘雄崇矛十砍渔哄炼泄霜族订田总债死照挡县疫尝医么指蝇肌训行睁丙虫钥歇森四阵绢繁毕否万予考交横勒撤龙于攻龄宁确价讨棉需衔雹侮岸茶捧肯悼挥纤延类咐起夹豆召股冷详连孕柳驳绩啦膏饮纲泊借草膝质城钩诵粥忘人患玻询血害慌爷体秤削嗽搞灯封吓榨沾哥刻艰伤凳恰力骆柱父扮撕坊成返窗屑妨摘怀童杏困粮表算品剩胳顽合狐誉蓄戚划杠间状仗碧亏脏馅筝细展怠赌念山分盖伯绳蛋望膊径即附宋心坑按睛谅岔鸟第沃台牵驼举弹暗垮桥稍弟魄撞双哭忌量销铅跃般锁案搜木墨蠢熄旬估耻垄彼乳奴剑膜救饶慈此统隔届祝酒议反劫邀狱潜伴竟更唯垫妥萄菠疮墙涛燃拦肩粉拿荷胀榆说循姿穴祸气浊失捎掩典漫路闻唱利絮丹甜有跨邻蛙烘少悬餐提译苦掀官穷饰流庄杯其画申匀调蚂某换环教泳搏昌恢复挂内魔底摇宿计件屿铜原嚼绪汤险萝拐早玩探尊蚀笋滩乙松已常前审箱弦鼓养选凡旧皮败冠疯给锻坐蕉遭授碑茄石堵织斜炒至兴厕仆候麻录遮冰夕袍可堂寇破碗倍躺企烂空筐葱填入受剪畏晓执朋批赚艇沈素要植狠德为贷盗雕纸脸制视道符嘉绿期幸刃斧赤卜割恳炎槐菊数掉挖镜炉顺通废芳蜻堡淡锋衫拘樱吹乐勤脑坏剧益篮仅夏挤辟获著煌厚汪幻笔跪厨由煮唐陷祖权刺没室观层王贝跟园键巨努评堆牺除器柄扩匆裁宇够既骨本级立耍还多滋吉啄福活逗吧堤朱损汇转茫扑恋试直慕的挺纹与谱侨例马问湖天圆仓州蔽恭飞馒电良准求杨钻持尺误以律圈狂被智凉绕耽愁剖微握滨雅鉴亡熊块兰薯风职莲泥宵歌紫何饼嫩些武样培融吨两兵孔面访丛港接诸推寄昆乘绒替都裂然猴形虏感芒隶避窜丢舌雀阀咽且齿乡仙痒监亭旱陆颗每判五骑颤供岛旅棕仔鲜辈鸡信敬驰欺锦督蔬概启罩款腐学商志弱稳灰较僵纳桶叹之扫括瓣秒中诉音棒稀击虚洪差守种们奶疲存磨鼻追课河许燥炊雨材女拨便蔑饥临索帝拍笨锹到盆育苏队海袜过架令界泡故址猎肝萌滴打颂晚搭揉控街俊切娃研蹈积脱尿闲纪脚斑方验送慨彩悔芝纠尘铺恩回下惰丝境群消印溉局沟贺斥公矩我宫伪独九螺古刷津旷图徐冲编迷违书砌凝巷费暴字抹蒜场带思刘煎移扯裤洗艺茧抗峡暮具躬测腾糖黑喷根把勺从歼哗铁年摊向厌坡汉迟关轨晒凭团作吞拒陕捡逝壁萍操棚儿鲁励享锯蒙僚身拾哲加称规役色亿实属识洲垃肚配陡闸招伍刮筹闯插伶桑领辨落秃尸谎特铲叉扭孤琴开约粒羡百忠慧固爆腹担慢管腰蜘雁苍码跳垂口率扒赖籍水掘甚杂待羊狡半远痰新裙郎香聚野郊鄙辱模一危纵型叨烫弃二惹顾乎颜看扰娘舱怒昏拉牧世蛮盯越初宴充热欠铃像阶轰俩舒生蹄光敲摸好滥久禾端窃邮巧嘱帅代喜淘眨涂熔银妇姓私乒药昨恶她明惊闪姥倾羽了警绘雄崇矛十砍渔哄炼泄霜族订田总债死照挡县疫尝医么指蝇肌训行睁丙虫钥歇森四阵绢繁毕否万予考交横勒撤龙于攻龄宁确价讨棉需衔雹侮岸茶捧肯悼挥纤延类咐起夹豆召股冷详连孕柳驳绩啦膏饮纲泊借草膝质城钩诵粥忘人患玻询血害慌爷体秤削嗽搞灯封吓榨沾哥刻艰伤凳恰力骆柱父扮撕坊成返窗屑妨摘怀童杏困粮表算品剩胳顽合狐誉蓄戚划杠间状仗碧亏脏馅筝细展怠赌念山分盖伯绳蛋望膊径即附宋心坑按睛谅岔鸟第沃台牵驼举弹暗垮桥稍弟魄撞双哭忌量销铅跃般锁案搜木墨蠢熄旬估耻垄彼乳奴剑膜救饶慈此统隔届祝酒议反劫邀狱潜伴竟更唯垫妥萄菠疮墙涛燃拦肩粉拿荷胀榆说循姿穴祸气浊失捎掩典漫路闻唱利絮丹甜有跨邻蛙烘少悬餐提译苦掀官穷饰流庄杯其画申匀调蚂某换环教泳搏昌恢复挂内魔底摇宿计件屿铜原嚼绪汤险萝拐早玩探尊蚀笋滩乙松已常前审箱弦鼓养选凡旧皮败冠疯给锻坐蕉遭授碑茄石堵织斜炒至兴厕仆候麻录遮冰夕袍可堂寇破碗倍躺企烂空筐葱填入受剪畏晓执朋批赚艇沈素要植狠德为贷盗雕纸脸制视道符嘉绿期幸刃斧赤卜割恳炎槐菊数掉挖镜炉顺通
    </div>
    <div id="popover">
      <button id="copyButton" onclick="clickCopy()">复制</button>
      <button id="searchButton" onclick="clickSearch()">查询</button>
    </div>
  </body>
</html>
<script>
  let selectedText = "";
  let textSelection;
  const customDom = document.createElement("div");
  customDom.style.backgroundColor = "#1788bd";
  customDom.style.borderRadius = "0 50% 50% 50%";
  customDom.style.width = "30px";
  customDom.style.height = "30px";

  window.onload = function () {
    const container = document.getElementById("container");
    const TextSelection = window.TextSelection.default;
    textSelection = new TextSelection({
      container: container, // 必须要传哦
      cursorDom: customDom, // 自定义游标dom(右侧)
      cursorColor: "#1788bd", // 左右指针颜色 可以不传  "red" || "#333333" || "rgba(125,125,125, 0.5)"
      rectsColor: "rgba(23,136,189,0.35)", // 选中文字的颜色 可以不传    "#333333aa" || "rgba(125,125,125, 0.5)" 需要是个透明色哦
      longTapDuration: 600, // 长按的时间 默认是600
      magnifierWidth: 0, // 放大镜宽度 默认100px
      magnifierHeight: 0, // 放大镜高度0默认50px
      magnifierOffset: 0, // 放大镜向上偏移的距离 默认50px
      onStart: () => {
        console.log("开始选择:正在长按或正在移动游标");
      }, // 开始选择的回调 可以不传
      onCancel: () => {
        popover.style.visibility = "hidden";
      }, // 失焦的回调 可以不传
      onFinish: ({ text, startX, startY, endX, endY }) => {
        console.log(
          "回调文字和坐标(相对于container)",
          text,
          "start: (",
          startX,
          ",",
          startY,
          ") end:(",
          endX,
          ",",
          endY,
          ")"
        );
        // 选中的字存起来
        selectedText = text;
        // ----- 下面是显示弹窗和计算弹窗位置 -----
        // 获取鼠标坐标
        let x_center = (startX + endX) / 2; // 按选中文字的中间计算
        let y_top = startY; // 按选中文字最上边计算

        // container相对位置
        const screenOffset = container.getBoundingClientRect();
        console.log("container offset:", screenOffset);
        // 以下是我写死的大小 css里写死的
        const popoverWidth = 120;
        const popoverHeight = 40;

        // 屏幕宽度
        const winWidth =
          document.documentElement.clientWidth || document.body.clientWidth;
        // 弹窗距离左右边界的距离哦
        const commonPaddingLR = 10;
        // 文档滚动的距离
        const scrollWidth =
          document.body.scrollLeft || document.documentElement.scrollLeft;

        // 判断x边界值，防止菜单栏溢出左右可视窗口
        if (x_center + screenOffset.left < popoverWidth / 2) {
          // 左边
          x_center = commonPaddingLR;
        } else if (x_center + screenOffset.left > winWidth - popoverWidth / 2) {
          // 右边
          x_center = winWidth - popoverWidth - commonPaddingLR;
        } else {
          // 中间
          x_center = screenOffset.left + x_center - popoverWidth / 2;
        }

        // 屏幕高度
        const winHeight =
          document.documentElement.clientHeight || document.body.clientHeight;
        // 弹窗距离上下边界的距离哦
        const commonPaddingTB = 10;
        const containerFontSize = 15;
        const popoverTopOffset = containerFontSize * 1 * 1.5; // 文字与弹窗之间的距离 1.5是行高 1代表一个字的高度 这是个不准确的数字
        // 文档滚动的距离
        const scrollHeight =
          document.body.scrollTop || document.documentElement.scrollTop;

        // 判断y边界值，防止菜单栏溢出上下可视窗口
        if (
          y_top + screenOffset.top <
          popoverTopOffset + popoverHeight + commonPaddingTB
        ) {
          // 上边
          y_top =
            y_top + popoverTopOffset * 2 +  screenOffset.top;
        } else {
          //中间
          y_top = y_top - popoverHeight - popoverTopOffset +  screenOffset.top;
        }

        // 显示弹窗
        const popover = document.getElementById("popover");
        popover.style.top = `${y_top}px`;
        popover.style.left = `${x_center}px`;
        popover.style.visibility = "visible";
      }, // 选完的回调 也可以不传
      tokenizer: (str, index) => {
        // console.log("需要分词的文字:", str, "文字长度:", str.length);
        // console.log("需要分词的文字索引:", index);
        // console.log("需要返回分词起始位置和长度");
        return [index, 1];
      },
    });
    // 初始化
    textSelection.init();
  };
  function del() {
    textSelection.destroy();
  }
  function clickCopy() {
    alert(`点击了复制 :${selectedText}`);
  }
  function clickSearch() {
    alert(`点击了查询 :${selectedText}`);
  }

</script>
